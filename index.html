<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>–ö–æ–ª–µ—Å–æ –§–æ—Ä—Ç—É–Ω—ã</title>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600&display=swap" rel="stylesheet"/>
  <style>
    :root {
      --bg: #f5f7fa;
      --card: #ffffff;
      --accent: #6366f1;
      --accent-light: #818cf8;
      --text: #1f2937;
      --shadow: rgba(0,0,0,0.1);
      --disabled: #ccc;
    }
    * { box-sizing:border-box; margin:0; padding:0; font-family:'Inter',sans-serif; }
    body {
      background:var(--bg);
      display:flex; justify-content:center; align-items:center;
      min-height:100vh; color:var(--text);
    }
    .container {
      background:var(--card);
      border-radius:16px;
      box-shadow:0 10px 30px var(--shadow);
      max-width:380px; width:90%;
      padding:2rem; text-align:center;
      position:relative;
    }
    h1 {
      font-size:1.75rem; margin-bottom:0.5rem; color:var(--accent);
    }
    #tickets {
      font-size:1rem; margin-bottom:1.5rem; font-weight:600;
    }
    /* –°—Ç—Ä–µ–ª–∫–∞ –Ω–∞–¥ –∫–æ–ª—ë—Å–æ–º */
    .arrow {
      position:absolute;
      top:2.5rem; left:50%;
      transform:translateX(-50%);
      font-size:2rem;
    }
    canvas {
      display:block; margin:auto;
      border-radius:50%; box-shadow:0 5px 15px var(--shadow);
    }
    button {
      margin-top:1.5rem; padding:0.75rem 1.5rem;
      background:var(--accent); color:#fff;
      border:none; border-radius:8px;
      font-size:1rem; cursor:pointer;
      transition:background 0.2s, transform 0.1s;
    }
    button:disabled {
      background:var(--disabled); cursor:not-allowed;
    }
    button:hover:not(:disabled) { background:var(--accent-light); }
    button:active:not(:disabled) { transform:scale(0.98); }
    #message {
      margin-top:1rem; font-weight:600;
      min-height:1.25em;
    }
    /* –ú–∏—à–∫–∞-–∞–Ω–∏–º–∞—Ü–∏—è */
    @keyframes bear {
      0%   { transform:scale(0) rotate(0deg); opacity:0 }
      50%  { transform:scale(1.2) rotate(20deg); opacity:1 }
      100% { transform:scale(1) rotate(0deg); opacity:1 }
    }
    #bear {
      position:absolute; width:80px; height:80px;
      top:calc(50% - 40px); left:calc(50% - 40px);
      pointer-events:none;
      display:none; z-index:10;
    }
  </style>
</head>
<body>
  <div class="container">
    <h1>üé° –ö–æ–ª–µ—Å–æ –§–æ—Ä—Ç—É–Ω—ã</h1>
    <div id="tickets">–ë–∏–ª–µ—Ç–æ–≤: ‚Äî</div>
    <div class="arrow">üî∫</div>
    <canvas id="wheel" width="300" height="300"></canvas>
    <button id="spin">–ö—Ä—É—Ç–∏—Ç—å</button>
    <div id="message"></div>
    <img id="bear" src="https://i.imgur.com/6YbG4Wc.png" alt="bear"/>
  </div>

  <script>
    const prizes = [
      { label:"‚ùå", color:"#fee2e2" },
      { label:"üé´", color:"#dbeafe" },
      { label:"üéÅ", color:"#d1fae5" },
      { label:"üêª", color:"#fef9c3" },
      { label:"üé´", color:"#ede9fe" },
      { label:"üéâ", color:"#ffe4e6" },
      { label:"üé´", color:"#cffafe" },
      { label:"üé´", color:"#edeff2" }
    ];
    const canvas = document.getElementById("wheel"),
          ctx    = canvas.getContext("2d"),
          R = 140, cx = 150, cy = 150,
          seg = 2*Math.PI/prizes.length;
    let angle = 0,
        tickets = 0;

    // –†–∏—Å—É–µ–º –∫–æ–ª–µ—Å–æ
    function drawWheel() {
      prizes.forEach((p,i) => {
        const start = angle + i*seg;
        ctx.beginPath();
        ctx.moveTo(cx,cy);
        ctx.arc(cx,cy,R,start,start+seg);
        ctx.fillStyle = p.color;
        ctx.fill();
        ctx.save();
        ctx.translate(
          cx + Math.cos(start+seg/2)*(R-35),
          cy + Math.sin(start+seg/2)*(R-35)
        );
        ctx.rotate(start+seg/2 + Math.PI/2);
        ctx.fillStyle = "#333";
        ctx.font = "22px sans-serif";
        ctx.fillText(p.label, -12,0);
        ctx.restore();
      });
      // —Å—Ç—Ä–µ–ª–∫–∞ —Ä–∏—Å—É–µ—Ç—Å—è –≤ HTML
    }

    // –ó–∞–≥—Ä—É–∂–∞–µ–º tickets –∏–∑ URL
    function loadTickets(){
      tickets = parseInt(new URLSearchParams(location.search).get("tickets")) || 0;
      document.getElementById("tickets").textContent = `–ë–∏–ª–µ—Ç–æ–≤: ${tickets}`;
      document.getElementById("spin").disabled = tickets < 1;
    }

    // –ê–Ω–∏–º–∞—Ü–∏—è –≤—Ä–∞—â–µ–Ω–∏—è
    function spinAnim(){
      document.getElementById("message").textContent = "";
      const spinCount = (Math.random()*3+5)*seg,
            dur = 3000,
            start = performance.now();
      function frame(ts){
        const t = Math.min((ts-start)/dur,1);
        angle = spinCount * (1 - Math.pow(1-t,3));
        ctx.clearRect(0,0,300,300);
        drawWheel();
        if(t < 1) requestAnimationFrame(frame);
        else onFinish();
      }
      requestAnimationFrame(frame);
    }

    // –ö–æ–≥–¥–∞ –≤—Ä–∞—â–µ–Ω–∏–µ –∑–∞–∫–æ–Ω—á–∏–ª–æ—Å—å
    function onFinish(){
      const idx = Math.floor(
        ((2*Math.PI - (angle%(2*Math.PI)))%(2*Math.PI)) / seg
      );
      const res = prizes[idx].label;
      if(res === "üêª") {
        showBear();
        document.getElementById("message").textContent = "üéâ –ú–∏—à–∫–∞ –ø–æ–π–º–∞–Ω!";
      } else {
        document.getElementById("message").textContent = `–í—ã–ø–∞–ª–æ ${res}.`;
      }
      // –æ—Ç—Å—ã–ª–∞–µ–º –±–æ—Ç—É
      if(window.Telegram?.WebApp) Telegram.WebApp.sendData(res);
    }

    // –ü–æ–∫–∞–∑–∞—Ç—å –º–∏—à–∫—É –∞–Ω–∏–º–∏—Ä–æ–≤–∞–Ω–æ
    function showBear(){
      const b = document.getElementById("bear");
      b.style.display = "block";
      b.style.animation = "bear 0.8s ease-out";
      setTimeout(()=> b.style.display = "none", 1200);
    }

    // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è
    drawWheel();
    loadTickets();
    document.getElementById("spin").onclick = spinAnim;
    if(window.Telegram?.WebApp) Telegram.WebApp.expand();
  </script>
</body>
</html>
