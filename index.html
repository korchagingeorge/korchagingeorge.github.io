<!DOCTYPE html>
<html lang="ru">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>–ö–æ–ª–µ—Å–æ —Ñ–æ—Ä—Ç—É–Ω—ã</title>
<link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600&display=swap" rel="stylesheet"/>
<style>
:root{
  --bg:#f0f2f7;--card:#fff;--accent:#6366f1;--accent2:#818cf8;
  --shadow:rgba(0,0,0,.1);--text:#1f2937;--disabled:#bbb
}
*{box-sizing:border-box;margin:0;padding:0;font-family:'Inter',sans-serif}
body{background:var(--bg);display:flex;justify-content:center;align-items:center;min-height:100vh;color:var(--text)}
.card{
  width:370px;max-width:95%;background:var(--card);border-radius:20px;
  box-shadow:0 10px 35px var(--shadow);padding:2rem 2rem 2.5rem;text-align:center;
}
h1{font-size:1.8rem;color:var(--accent);margin-bottom:.7rem}
#tickets{font-weight:600;margin-bottom:1.2rem}
#wheelBox{position:relative;width:300px;margin:0 auto}
#arrow{
  position:absolute;left:50%;top:-22px;transform:translateX(-50%);
  width:0;height:0;border-left:16px solid transparent;border-right:16px solid transparent;
  border-bottom:26px solid #333;border-radius:3px
}
canvas{border-radius:50%;width:300px;height:300px;box-shadow:0 4px 18px var(--shadow)}
button{
  margin-top:1.5rem;padding:.9rem 2rem;font-size:1.05rem;font-weight:600;
  color:#fff;background:var(--accent);border:none;border-radius:12px;
  cursor:pointer;transition:background .2s,transform .1s
}
button[disabled]{background:var(--disabled);cursor:not-allowed}
button:not([disabled]):hover{background:var(--accent2)}
button:not([disabled]):active{transform:scale(.97)}
#msg{margin-top:1rem;height:1.4em;font-weight:600}
#bear{
  position:absolute;top:50%;left:50%;transform:translate(-50%,-50%) scale(0);
  width:110px;height:110px;pointer-events:none;opacity:0;transition:transform .8s cubic-bezier(.23,1.1,.32,1),opacity .8s
}
#bear.show{transform:translate(-50%,-50%) scale(1);opacity:1}
#shopBtn{position:absolute;top:1.3rem;right:1.3rem;background:#fff;border:none}
#shopBtn img{width:28px;height:28px}
.modal{
  position:fixed;left:0;top:0;width:100%;height:100%;display:none;align-items:center;justify-content:center;
  background:rgba(0,0,0,.45);backdrop-filter:blur(2px);z-index:50
}
.modal.show{display:flex}
.modal>div{
  background:var(--card);padding:1.8rem;border-radius:16px;text-align:center;width:90%;max-width:320px;
  box-shadow:0 6px 25px var(--shadow)
}
.item{display:flex;align-items:center;justify-content:space-between;margin:1rem 0}
.item span{font-size:1.1rem}
.item button{padding:.4rem 1rem;font-size:.9rem;margin:0}
</style>
</head>
<body>
  <div class="card">
    <button id="shopBtn" title="–ú–∞–≥–∞–∑–∏–Ω"><img src="https://img.icons8.com/fluency-systems-filled/48/shop.png"/></button>
    <h1>üé° –ö–æ–ª–µ—Å–æ —Ñ–æ—Ä—Ç—É–Ω—ã</h1>
    <div id="tickets">–ë–∏–ª–µ—Ç–æ–≤: ‚Äî</div>

    <div id="wheelBox">
      <div id="arrow"></div>
      <canvas id="wheel" width="300" height="300"></canvas>
      <img id="bear" src="https://i.imgur.com/6YbG4Wc.png" alt="bear">
    </div>

    <button id="spin">–ö—Ä—É—Ç–∏—Ç—å</button>
    <div id="msg"></div>
  </div>

  <!---- Modal-–º–∞–≥–∞–∑–∏–Ω -->
  <div class="modal" id="shop">
    <div>
      <h2 style="margin-bottom:1rem">üõç –ú–∞–≥–∞–∑–∏–Ω</h2>
      <div class="item">
        <span>–ü–ª—é—à–µ–≤—ã–π –º–∏—à–∫–∞ ‚Äî 3 üé´</span>
        <button id="buyBear">–ö—É–ø–∏—Ç—å</button>
      </div>
      <button style="margin-top:1.2rem" onclick="toggleShop()">–ó–∞–∫—Ä—ã—Ç—å</button>
    </div>
  </div>

<script>
const prizes=[
  {e:'‚ùå',c:'#fee2e2'},{e:'üé´',c:'#dbeafe'},{e:'üéÅ',c:'#d1fae5'},
  {e:'üêª',c:'#fef9c3'},{e:'üé´',c:'#ede9fe'},{e:'üéâ',c:'#ffe4e6'},
  {e:'üé´',c:'#cffafe'},{e:'üé´',c:'#e0e7ff'}
];
const canvas=document.getElementById('wheel'),ctx=canvas.getContext('2d');
const R=140,cx=150,cy=150,seg=2*Math.PI/prizes.length;
let angle=0,tickets=0,spinning=false;

function draw(){
  prizes.forEach((p,i)=>{
    const s=angle+i*seg;
    ctx.beginPath();ctx.moveTo(cx,cy);ctx.arc(cx,cy,R,s,s+seg);
    ctx.fillStyle=p.c;ctx.fill();
    ctx.save();
      ctx.translate(cx+Math.cos(s+seg/2)*(R-32),cy+Math.sin(s+seg/2)*(R-32));
      ctx.rotate(s+seg/2+Math.PI/2);
      ctx.font='24px sans-serif';ctx.fillStyle='#333';
      ctx.fillText(p.e,-12,8);
    ctx.restore();
  });
}
draw();

function updateTickets(v){
  tickets=v;
  document.getElementById('tickets').textContent=`–ë–∏–ª–µ—Ç–æ–≤: ${tickets}`;
  document.getElementById('spin').disabled=tickets<1||spinning;
}
function readTickets(){
  const t=parseInt(new URLSearchParams(location.search).get('tickets'))||0;
  updateTickets(t);
}
readTickets();

document.getElementById('spin').onclick=()=>{
  if(tickets<1||spinning)return;
  spinning=true;updateTickets(tickets); // disable
  const msg=document.getElementById('msg');msg.textContent='';
  const duration=3200,totalRot=(Math.random()*3+5)*seg,start=performance.now();
  const anim=ts=>{
    const t=Math.min((ts-start)/duration,1);
    angle=totalRot*(1-(1-t)**3);
    ctx.clearRect(0,0,300,300);draw();
    if(t<1)requestAnimationFrame(anim);else finish();
  };
  requestAnimationFrame(anim);
};

function finish(){
  spinning=false;
  tickets--;updateTickets(tickets);
  const idx=Math.floor(((2*Math.PI-(angle% (2*Math.PI)))%(2*Math.PI))/seg);
  const res=prizes[idx].e;
  const msg=document.getElementById('msg');
  if(res==='üêª'){showBear();msg.textContent='üéâ –ú–∏—à–∫–∞ –ø–æ–π–º–∞–Ω!';}
  else msg.textContent=`–í—ã–ø–∞–ª–æ ${res}.`;
  // –æ—Ç–ø—Ä–∞–≤–ª—è–µ–º —Ä–µ–∑—É–ª—å—Ç–∞—Ç + –æ—Å—Ç–∞–≤—à–∏–µ—Å—è –±–∏–ª–µ—Ç—ã
  if(window.Telegram?.WebApp)Telegram.WebApp.sendData(JSON.stringify({type:'spin',prize:res}));
}

function showBear(){
  const b=document.getElementById('bear');
  b.classList.add('show');setTimeout(()=>b.classList.remove('show'),1500);
}

/* ‚Äî‚Äî‚Äî –ú–∞–≥–∞–∑–∏–Ω ‚Äî‚Äî‚Äî */
function toggleShop(){document.getElementById('shop').classList.toggle('show');}
document.getElementById('shopBtn').onclick=toggleShop;
document.getElementById('buyBear').onclick=()=>{
  if(tickets<3){alert('–ù–µ —Ö–≤–∞—Ç–∞–µ—Ç –±–∏–ª–µ—Ç–æ–≤!');return;}
  tickets-=3;updateTickets(tickets);
  if(window.Telegram?.WebApp)Telegram.WebApp.sendData(JSON.stringify({type:'buy',item:'bear'}));
  alert('–ü–æ–∫—É–ø–∫–∞ —É—Å–ø–µ—à–Ω–∞! üéâ');
};
/* expand */
if(window.Telegram?.WebApp)Telegram.WebApp.expand();
</script>
</body>
</html>
