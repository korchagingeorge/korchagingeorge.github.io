<!DOCTYPE html>
<html lang="ru">
<head>
<meta charset="UTF-8"/>
<meta name="viewport" content="width=device-width,initial-scale=1"/>
<title>ĞšĞ¾Ğ»ĞµÑĞ¾ Ñ„Ğ¾Ñ€Ñ‚ÑƒĞ½Ñ‹</title>
<link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600&display=swap" rel="stylesheet"/>
<style>
 :root{
   --bg:#f1f4f9;--card:#fff;--accent:#6366f1;--accent2:#818cf8;--text:#1f2937;
   --shadow:rgba(0,0,0,.08);--disabled:#b8b8b8
 }
 *{box-sizing:border-box;margin:0;padding:0;font-family:'Inter',sans-serif}
 body{background:var(--bg);min-height:100vh;color:var(--text);overflow:hidden}
 /* â€”â€”â€” layout â€”â€”â€” */
 #app{position:relative;width:100%;height:100vh;display:flex;flex-direction:column}
 .pages{flex:1;display:flex;transition:transform .35s ease;will-change:transform}
 .page{flex:0 0 100%;height:100%;overflow-y:auto;padding-bottom:90px}
 /* â€”â€”â€” bottom tabbar â€”â€”â€” */
 .tabbar{height:70px;background:var(--card);box-shadow:0 -4px 18px var(--shadow);display:flex;justify-content:space-around;align-items:center;position:fixed;bottom:0;left:0;right:0;border-top-left-radius:18px;border-top-right-radius:18px}
 .tabbar button{background:none;border:none;display:flex;flex-direction:column;align-items:center;color:#777;font-size:.75rem;font-weight:600;cursor:pointer}
 .tabbar img{width:26px;height:26px;margin-bottom:4px;filter:grayscale(1);transition:filter .25s}
 .tabbar button.active img{filter:grayscale(0)}
 .tabbar button.active{color:var(--accent)}
 /* â€”â€”â€” WHEEL PAGE â€”â€”â€” */
 .card{width:90%;max-width:380px;background:var(--card);border-radius:22px;box-shadow:0 12px 36px var(--shadow);padding:2rem 2rem 2.3rem;margin:2.2rem auto 0;text-align:center;position:relative}
 h1{font-size:1.8rem;color:var(--accent);margin-bottom:.7rem;font-weight:700}
 #tickets{font-weight:600;margin-bottom:1.2rem}
 #wheelWrap{width:300px;height:300px;margin:0 auto;position:relative}
 #arrow{position:absolute;left:50%;bottom:-24px;transform:translateX(-50%) rotate(180deg);width:0;height:0;border-left:18px solid transparent;border-right:18px solid transparent;border-top:28px solid #333;border-radius:3px}
 canvas{border-radius:50%;width:300px;height:300px;box-shadow:0 4px 20px var(--shadow)}
 #spin{margin-top:1.4rem;padding:.85rem 2.1rem;font-size:1.05rem;font-weight:600;color:#fff;background:var(--accent);border:none;border-radius:12px;cursor:pointer;transition:background .2s,transform .1s}
 #spin[disabled]{background:var(--disabled);cursor:not-allowed}
 #spin:not([disabled]):hover{background:var(--accent2)}
 #spin:not([disabled]):active{transform:scale(.97)}
 #msg{margin-top:1rem;height:1.3em;font-weight:600}
 #bear{position:absolute;left:50%;top:50%;transform:translate(-50%,-50%) scale(0);opacity:0;width:120px;height:120px;pointer-events:none;transition:transform .8s cubic-bezier(.23,1.1,.32,1),opacity .8s;z-index:5}
 #bear.show{transform:translate(-50%,-50%) scale(1);opacity:1}
 @keyframes ticketFly{0%{transform:translate(-50%,-50%) scale(.5);opacity:0}50%{opacity:1}100%{transform:translate(-50%,-180%) scale(1);opacity:0}}
 .ticketAnim{position:absolute;left:50%;top:50%;transform:translate(-50%,-50%);font-size:32px;pointer-events:none;animation:ticketFly .9s forwards}
 /* â€”â€”â€” SHOP PAGE â€”â€”â€” */
 .shopWrap{padding:1.2rem}
 .item{background:var(--card);border-radius:18px;box-shadow:0 4px 18px var(--shadow);padding:1.3rem;margin:1rem auto;max-width:350px;display:flex;justify-content:space-between;align-items:center}
 .item button{padding:.5rem 1.2rem;border:none;border-radius:10px;background:var(--accent);color:#fff;font-weight:600;font-size:.9rem;cursor:pointer}
 .item button:hover{background:var(--accent2)}
 /* â€”â€”â€” REFS PAGE â€”â€”â€” */
 .refWrap{padding:1.3rem;text-align:center}
 .refWrap p{margin:.9rem 0}
 .linkBox{background:var(--card);padding:.8rem;border-radius:14px;box-shadow:0 4px 18px var(--shadow);word-break:break-all}
 .copyBtn{margin-top:1rem;padding:.55rem 1.4rem;border:none;border-radius:10px;background:var(--accent);color:#fff;font-weight:600;cursor:pointer}
 .copyBtn:hover{background:var(--accent2)}
</style>
</head>
<body>
<div id="app">
   <div class="pages" id="pages">
     <!-- PAGE 0 : WHEEL -->
     <section class="page">
       <div class="card">
         <h1>ğŸ¡ ĞšĞ¾Ğ»ĞµÑĞ¾</h1>
         <div id="tickets">Ğ‘Ğ¸Ğ»ĞµÑ‚Ğ¾Ğ²: 1</div>
         <div id="wheelWrap">
           <div id="arrow"></div>
           <canvas id="wheel" width="300" height="300"></canvas>
           <img id="bear" src="https://i.imgur.com/6YbG4Wc.png" alt="bear"/>
         </div>
         <button id="spin">ĞšÑ€ÑƒÑ‚Ğ¸Ñ‚ÑŒ</button>
         <div id="msg"></div>
       </div>
     </section>
     <!-- PAGE 1 : SHOP -->
     <section class="page">
       <div class="shopWrap">
         <h2 style="text-align:center;font-size:1.5rem;color:var(--accent);margin-top:1.2rem">ğŸ› ĞœĞ°Ğ³Ğ°Ğ·Ğ¸Ğ½</h2>
         <div class="item">
           <span>ĞŸĞ»ÑÑˆĞµĞ²Ñ‹Ğ¹ Ğ¼Ğ¸ÑˆĞºĞ° â€” 3 ğŸ«</span>
           <button id="buyBear">ĞšÑƒĞ¿Ğ¸Ñ‚ÑŒ</button>
         </div>
       </div>
     </section>
     <!-- PAGE 2 : REFERRALS -->
     <section class="page">
       <div class="refWrap">
         <h2 style="font-size:1.5rem;color:var(--accent)">ğŸ‘¥ Ğ ĞµÑ„ĞµÑ€Ğ°Ğ»Ñ‹</h2>
         <p>ĞŸÑ€Ğ¸Ğ³Ğ»Ğ°ÑĞ¸Ñ‚Ğµ Ğ´Ñ€ÑƒĞ³Ğ° Ğ¸ Ğ¿Ğ¾Ğ»ÑƒÑ‡Ğ¸Ñ‚Ğµ 1 ğŸ«, ĞºĞ¾Ğ³Ğ´Ğ° Ğ¾Ğ½ Ğ²ÑÑ‚ÑƒĞ¿Ğ¸Ñ‚ Ğ² ĞºĞ°Ğ½Ğ°Ğ».</p>
         <div class="linkBox" id="refLink">â€”</div>
         <button class="copyBtn" id="copyRef">Ğ¡ĞºĞ¾Ğ¿Ğ¸Ñ€Ğ¾Ğ²Ğ°Ñ‚ÑŒ ÑÑÑ‹Ğ»ĞºÑƒ</button>
       </div>
     </section>
   </div>
   <!-- bottom navigation -->
   <nav class="tabbar">
     <button data-idx="0" class="active"><img src="https://img.icons8.com/ios-filled/50/000000/roulette.png"/>ĞšĞ¾Ğ»ĞµÑĞ¾</button>
     <button data-idx="1"><img src="https://img.icons8.com/ios-glyphs/60/000000/shopping-bag.png"/>ĞœĞ°Ğ³Ğ°Ğ·Ğ¸Ğ½</button>
     <button data-idx="2"><img src="https://img.icons8.com/ios-filled/50/000000/conference-call.png"/>Ğ ĞµÑ„ĞµÑ€Ğ°Ğ»Ñ‹</button>
   </nav>
</div>

<script>
/* ====== CONFIG ====== */
const sectors=[
 {e:'âŒ',c:'#fee2e2',delta:0},
 {e:'ğŸ«',c:'#dbeafe',delta:1},
 {e:'ğŸ',c:'#d1fae5',delta:0},
 {e:'ğŸ»',c:'#fef9c3',delta:0},
 {e:'ğŸ«',c:'#ede9fe',delta:1},
 {e:'ğŸ‰',c:'#ffe4e6',delta:0},
 {e:'ğŸ«',c:'#cffafe',delta:1},
 {e:'ğŸ«',c:'#e0e7ff',delta:1}
];
/* ====== STATE ====== */
let tickets=1,angle=0,spinning=false,page=0,startX=null;
/* ====== DOM ====== */
const spinBtn=document.getElementById('spin');
const msg=document.getElementById('msg');
const bear=document.getElementById('bear');
const ticketBox=document.getElementById('tickets');
const pages=document.getElementById('pages');
const tabButtons=[...document.querySelectorAll('.tabbar button')];
const canvas=document.getElementById('wheel');
const ctx=canvas.getContext('2d');
const R=140,cx=150,cy=150,seg=2*Math.PI/sectors.length;
/* ====== INIT ====== */
function init(){
  // tickets from URL or 1
  const qs=new URLSearchParams(location.search);
  tickets=parseInt(qs.get('tickets'))||1;
  ticketBox.textContent=`Ğ‘Ğ¸Ğ»ĞµÑ‚Ğ¾Ğ²: ${tickets}`;
  spinBtn.disabled=tickets<1;
  // referral link if available
  if(window.Telegram?.WebApp){
    const uname=Telegram.WebApp.initDataUnsafe?.user?.username||'your_bot';
    const uid=Telegram.WebApp.initDataUnsafe?.user?.id||'';
    document.getElementById('refLink').textContent=`https://t.me/${uname}?start=ref${uid}`;
  } else {
    document.getElementById('refLink').textContent='Ğ—Ğ°Ğ³Ñ€ÑƒĞ·Ğ¸Ñ‚Ğµ Ğ² Telegram';
  }
  draw();
}
/* ====== DRAW WHEEL ====== */
function draw(){
  sectors.forEach((s,i)=>{
    const start=angle+i*seg;
    ctx.beginPath();ctx.moveTo(cx,cy);ctx.arc(cx,cy,R,start,start+seg);
    ctx.fillStyle=s.c;ctx.fill();
    ctx.save();
      ctx.translate(cx+Math.cos(start+seg/2)*(R-34),cy+Math.sin(start+seg/2)*(R-34));
      ctx.rotate(start+seg/2+Math.PI/2);
      ctx.font='25px sans-serif';ctx.fillStyle='#333';
      ctx.fillText(s.e,-13,10);
    ctx.restore();
  });
}
/* ====== SPIN ====== */
spinBtn.onclick=()=>{
  if(spinning||tickets<1)return;
  spinning=true;spinBtn.disabled=true;msg.textContent='';
  const totalRot=(Math.random()*3+5)*seg,dur=3200,start=performance.now();
  requestAnimationFrame(function anim(ts){
    const t=Math.min((ts-start)/dur,1);
    angle=totalRot*(1-(1-t)**3);
    ctx.clearRect(0,0,300,300);draw();
    if(t<1)requestAnimationFrame(anim);else finishSpin();
  });
};
function finishSpin(){
  spinning=false;
  tickets--; // cost of spin
  const idx=Math.floor(((2*Math.PI-(angle%(2*Math.PI)))%(2*Math.PI))/seg);
  const res=sectors[idx];
  tickets+=res.delta;
  ticketBox.textContent=`Ğ‘Ğ¸Ğ»ĞµÑ‚Ğ¾Ğ²: ${tickets}`;
  spinBtn.disabled=tickets<1;
  if(res.e==='ğŸ»'){bear.classList.add('show');setTimeout(()=>bear.classList.remove('show'),1600);msg.textContent='ğŸ‰ ĞœĞ¸ÑˆĞºĞ° Ğ¿Ğ¾Ğ¹Ğ¼Ğ°Ğ½!';}
  else {
    msg.textContent=`Ğ’Ñ‹Ğ¿Ğ°Ğ»Ğ¾ ${res.e}${res.delta? ' â€” +1 ğŸ«':''}`;
    if(res.e==='ğŸ«')ticketBurst();
  }
  sendEvent({type:'spin',prize:res.e});
}
function ticketBurst(){
  const el=document.createElement('div');el.className='ticketAnim';el.textContent='ğŸ«';
  document.body.appendChild(el);setTimeout(()=>el.remove(),900);
}
/* ====== SHOP ====== */
const buyBearBtn=document.getElementById('buyBear');
buyBearBtn.onclick=()=>{
  if(tickets<3){alert('ĞĞµ Ñ…Ğ²Ğ°Ñ‚Ğ°ĞµÑ‚ Ğ±Ğ¸Ğ»ĞµÑ‚Ğ¾Ğ²!');return;}
  tickets-=3;ticketBox.textContent=`Ğ‘Ğ¸Ğ»ĞµÑ‚Ğ¾Ğ²: ${tickets}`;spinBtn.disabled=tickets<1;
  alert('Ğ¡Ğ¿Ğ°ÑĞ¸Ğ±Ğ¾ Ğ·Ğ° Ğ¿Ğ¾ĞºÑƒĞ¿ĞºÑƒ! ğŸ‰');
  sendEvent({type:'buy',item:'bear'});
};
/* ====== REFERRALS ====== */
document.getElementById('copyRef').onclick=()=>{
  const link=document.getElementById('refLink').textContent;
  navigator.clipboard.writeText(link).then(()=>alert('Ğ¡ÑÑ‹Ğ»ĞºĞ° ÑĞºĞ¾Ğ¿Ğ¸Ñ€Ğ¾Ğ²Ğ°Ğ½Ğ°'));
};
/* ====== SEND EVENT ====== */
function sendEvent(obj){
  if(window.Telegram?.WebApp)Telegram.WebApp.sendData(JSON.stringify(obj));
}
/* ====== NAV / SWIPE ====== */
function showPage(i){page=(i+3)%3;pages.style.transform=`translateX(-${page*100}%)`;
  tabButtons.forEach(b=>b.classList.toggle('active',+b.dataset.idx===page));
}
tabButtons.forEach(btn=>btn.onclick=()=>showPage(+btn.dataset.idx));
// swipe gesture
pages.addEventListener('touchstart',e=>startX=e.touches[0].clientX);
pages.addEventListener('touchend',e=>{
  if(startX===null)return;const dx=e.changedTouches[0].clientX-startX;if(Math.abs(dx)>50){showPage(page+(dx<0?1:-1));}startX=null;});
/* ====== RUN ====== */
init();
</script>
</body>
</html>
